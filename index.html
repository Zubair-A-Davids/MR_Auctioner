<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mirage Realms Auctioner</title>
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="stylesheet" href="styles.css">
  <link rel="preload" as="image" href="icon.png">
  <link rel="preload" as="image" href="Gold.png">
  <style>
    .item-type-image[title]:hover::after {
      content: attr(title);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, rgba(0, 217, 255, 0.95), rgba(0, 184, 212, 0.95));
      color: var(--primary-dark);
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      white-space: normal;
      max-width: 200px;
      font-size: 0.75rem;
      font-weight: 600;
      z-index: 1000;
      pointer-events: none;
      margin-bottom: 0.5rem;
      border: 1px solid var(--primary);
      box-shadow: 0 4px 12px rgba(0, 217, 255, 0.4);
    }
  </style>
</head>

<body>
  <!-- Loading Screen -->
  <div id="loading-screen" style="position: fixed; inset: 0; background: linear-gradient(135deg, #0a1929, #132f4c); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999;">
    <img src="icon.png" alt="MR Auctioner" style="width: 100px; height: 100px; margin-bottom: 1.5rem; animation: pulse 2s ease-in-out infinite;">
    <div style="color: var(--primary); font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem;">MR Auctioner</div>
    <div class="loading-spinner" style="width: 50px; height: 50px; border: 4px solid rgba(0, 217, 255, 0.1); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
    <div style="color: rgba(255, 255, 255, 0.6); margin-top: 1rem; font-size: 0.9rem;">Loading...</div>
  </div>
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); will-change: transform; }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); will-change: transform, opacity; }
    }
  </style>
  
  <header class="site-header">
    <div class="header-left">
      <h1 class="site-title" style="cursor: pointer;" id="site-title-link"><img src="icon.png" alt="" class="site-logo"> MR Auctioner</h1>
      <div id="api-status" class="api-status" title="API Connection Status">
        <span class="api-status-dot"></span>
        <span class="api-status-text">Checking...</span>
      </div>
    </div>
    <nav>
      <div class="nav-user-section">
        <div id="navbar-avatar-wrap" class="navbar-avatar-wrap hidden">
          <img id="navbar-avatar" src="" alt="avatar" class="navbar-avatar-img" />
        </div>
        <span id="user-greeting"></span>
      </div>
      <div class="nav-controls">
        <div class="hamburger-wrap">
          <button id="btn-hamburger" aria-label="menu" title="menu" class="hidden">☰</button>
          <div id="hamburger-menu" class="hamburger-menu hidden">
            <button id="btn-sell-item" class="menu-item">Sell an item</button>
            <button id="btn-view-listings-menu" class="menu-item">View Listings</button>
            <li><a href="#" id="nav-listings" class="nav-link">Marketplace</a></li>
            <li><a href="#" id="nav-giveaways" class="nav-link" style="color: #00d9ff; display: flex; align-items: center; gap: 8px;"><i class="icon-gift" style="font-size: 1.1em;"></i> Giveaways</a></li>
            <li><a href="#" id="nav-profile" class="nav-link">My Profile</a></li>
            <button id="btn-warnings" class="menu-item hidden">Warnings</button>
            <button id="btn-items-sold" class="menu-item hidden">Items Sold History</button>
            <button id="btn-admin-panel" class="menu-item hidden">Admin Panel</button>
            <button id="btn-mod-panel" class="menu-item hidden">Moderation</button>
            <button id="btn-mod-history" class="menu-item hidden">Moderation History</button>
            <button id="btn-user-help" class="menu-item">FAQ / Help</button>
          </div>
        </div>
        <button id="btn-show-register" class="btn btn-primary">Register</button>
        <button id="btn-show-login" class="btn btn-primary">Login</button>
        <button id="btn-logout" class="btn btn-primary hidden">Logout</button>
      </div>
    </nav>
  </header>

  <main>
    <div id="site-message" class="message hidden"></div>

    <section id="auth-area">
      <div class="card hidden" id="register-card">
        <h2>Create Account</h2>
        <label>Username <input id="reg-username" /></label>
        <div class="field-error" id="reg-username-error"></div>
        <label>Password <input id="reg-password" type="password" /></label>
        <div class="field-error" id="reg-password-error"></div>
        <label>Confirm Password <input id="reg-password-confirm" type="password" /></label>
        <div class="field-error" id="reg-password-confirm-error"></div>
        <label>Display Name <input id="reg-displayname" maxlength="20" /></label>
        <div class="field-error" id="reg-displayname-error"></div>
        <label>Discord Name <input id="reg-discord" maxlength="20" placeholder="e.g. user#1234" /></label>
        <div class="field-error" id="reg-discord-error"></div>
        <p class="hint" style="color:red;font-weight:bold">Do not use your in-game logins. Username is for logging in, Display Name is what others will see.</p>
          <label>Bio <textarea id="reg-bio" rows="3" maxlength="100" placeholder="Tell others about you (optional)"></textarea></label>
          <div class="avatar-upload-row" style="margin:.5rem 0 0">
            <div id="reg-avatar-preview-wrap" class="avatar-wrap preview-empty"><img id="reg-avatar-preview" src="" alt="avatar preview" class="avatar-img hidden" /></div>
            <label class="btn btn-primary btn-change-avatar">Choose Avatar <input id="reg-avatar" type="file" accept=".jpg,.jpeg,.png,.gif,.webp" class="hidden" /></label>
          </div>
        <div class="form-actions">
          <button id="btn-register" class="btn btn-primary">Create account</button>
          <button id="btn-cancel-register" class="btn">Cancel</button>
        </div>
      </div>

      <div class="card hidden" id="login-card">
        <h2>Login</h2>
        <label>Username <input id="login-username" maxlength="20" /></label>
        <label>Password <input id="login-password" type="password" /></label>
        <div class="form-actions">
          <button id="btn-login" class="btn btn-primary">Login</button>
          <button id="btn-cancel-login" class="btn">Cancel</button>
        </div>
      </div>
    </section>

    <section id="create-listing-area" class="card hidden">
      <h2>Create Listing</h2>
      <div class="button-group" style="display: flex; gap: 10px; margin-bottom: 1rem;">
        <button id="btn-open-item-types" class="btn btn-primary">Browse Item Types</button>
        <button id="btn-how-to" class="btn btn-accent">How to</button>
        <button id="btn-rules" class="btn btn-accent" style="background-color: #4a4a4a;">Basic Rules</button>
      </div>
      <label>Item name <input id="item-title" maxlength="30" placeholder="Enter item name or select from Browse Item Types..." /></label>
      <label>Item Type Description (read-only) <textarea id="item-type-desc" disabled class="disabled-input"></textarea></label>
      <label>Your Listing Description <input id="item-desc" maxlength="40" placeholder="Add details about this specific listing..." /></label>
      <label>Price
        <div class="price-spinner">
          <button id="btn-price-minus" class="btn btn-accent">−</button>
          <input id="item-price" type="number" min="1" value="1" />
          <button id="btn-price-plus" class="btn btn-accent">+</button>
          <img src="Gold.png" alt="gold" class="gold-icon" />
        </div>
      </label>

      <div class="status-selection">
        <label class="status-label">
          <input type="checkbox" id="item-elite" />
          <span>Elite</span>
          <img src="Items/Elite/Elite.png" alt="Elite" class="status-preview-icon" />
        </label>
      </div>

      <label>Element (optional)
        <select id="item-element" class="search-select">
          <option value="">None</option>
          <option value="Energy">Energy</option>
          <option value="Fire">Fire</option>
          <option value="Ice">Ice</option>
          <option value="Mana">Mana</option>
          <option value="Nature">Nature</option>
          <option value="Physical">Physical</option>
        </select>
      </label>

      <div class="file-input" id="image-drop-zone">
        <span>Image (optional) - Click, Drag & Drop, or Paste (Ctrl+V)</span>
        <label class="btn btn-primary file-label">Choose Screenshot
          <input id="item-image" type="file" accept=".jpg,.jpeg,.png,.gif,.webp" class="hidden" />
        </label>
      </div>

      <p class="hint" id="selected-item-info"></p>
      <div id="image-preview-container" style="max-width: 100%; overflow: hidden;">
        <img id="item-image-preview" alt="preview" class="hidden" />
      </div>
      <input type="hidden" id="editing-id" />
      <div class="form-actions">
        <button id="btn-create-listing" class="btn btn-primary">Create listing</button>
        <button id="btn-view-listings" class="btn btn-accent">View Listings</button>
        <button id="btn-cancel-edit" class="btn btn-accent hidden">Cancel</button>
      </div>
    </section>

<section id="landing" class="card">
  <h2>Welcome to Mirage Realms Auctioner</h2>
  <p class="hint">Mirage Realms Unofficial Experimental Auction House, register and login to sell items.</p>
  <p class="hint">
  <strong>Note:</strong> This site adheres to all 
  <a href="https://miragerealms.co.uk/support/knowledgebase.php?article=5" target="_blank" rel="noopener noreferrer" class="accent-text">
    Mirage Realms Rules
  </a>.  
  <span style="color: red; font-weight: bold;">Account trading is strictly prohibited and <strong>WILL</strong> get you bonked.</span>
</p>
  <p class="hint"><span class="accent-text">Browse active listings below. </span> Enjoy your stay and visit the MR Auctioner Discord Server to report any bugs or issues :D</p>
  <div class="hint discord-links" style="display: flex; justify-content: center; gap: 48px; margin-top: 24px;">
    <a href="https://discord.com/invite/EFuRXaanGC" target="_blank" rel="noopener noreferrer">
      <img src="icon.png" alt="MR Auctioner Discord" class="social-logo" />
    </a>
    <a href="https://discord.com/invite/7MHQaTjjMR" target="_blank" rel="noopener noreferrer">
      <img src="discord-logo.png" alt="Mirage Realms Discord" class="social-logo" />
    </a>
    <a href="https://www.miragerealms.co.uk/wiki/" target="_blank" rel="noopener noreferrer">
      <img src="wiki-icon.png" alt="Mirage Realms Wiki" class="social-logo" />
    </a>
  </div>
</section>

<!-- Site Statistics -->
<section id="site-stats" class="card stats-card hidden">
  <div class="filter-header">
    <h3 style="margin:0;color:var(--primary);font-size:1rem">Site Statistics</h3>
    <button id="toggle-stats" class="btn btn-small btn-primary" aria-label="Toggle stats">−</button>
  </div>
  <div id="stats-content" class="filter-content">
    <div class="stats-grid">
    <div class="stat-item">
      <div class="stat-value" id="stat-users">-</div>
      <div class="stat-label">Total Users</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="stat-listings">-</div>
      <div class="stat-label">Active Listings</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="stat-sold">-</div>
      <div class="stat-label">Items Sold</div>
    </div>
    </div>
  </div>
</section>

<section id="listings-section" class="hidden">
  <h2>Active Listings</h2>
    <div id="search-filters" class="card search-filters-card">
      <div class="filter-header">
        <h3 style="margin:0;color:var(--primary);font-size:1rem">Search & Filters</h3>
        <button id="toggle-filters" type="button" class="btn btn-small btn-primary" aria-label="Toggle filters">−</button>
      </div>
      <div id="filter-content" class="filter-content">
        <div class="search-grid">
          <div class="search-field">
            <label>Search by Name</label>
            <div style="display: flex; gap: 0.5rem;">
              <input id="search-name" type="text" placeholder="Filter by Item or User name..." style="flex: 1;" />
              <button id="search-button" type="button" class="btn btn-primary" style="min-width: 100px;">Search</button>
            </div>
          </div>
          <div class="search-field">
            <label for="search-price">Sort by Price</label>
            <select id="search-price" class="search-select" aria-label="Sort by Price" title="Sort by Price">
              <option value="none">No Sort</option>
              <option value="low-high">Low to High</option>
              <option value="high-low">High to Low</option>
            </select>
          </div>
          <div class="search-field">
            <label for="search-sort">Sort by Date</label>
            <select id="search-sort" class="search-select" aria-label="Sort by Date" title="Sort by Date">
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
            </select>
          </div>
          <div class="search-field">
            <label for="search-elite">Elite Status</label>
            <select id="search-elite" class="search-select" aria-label="Elite Status Filter" title="Elite Status Filter">
              <option value="all">All Items</option>
              <option value="elite">Elite Only</option>
              <option value="non-elite">Non-Elite Only</option>
            </select>
          </div>
          <div class="search-field">
            <label for="search-element">Element</label>
            <select id="search-element" class="search-select" aria-label="Element Filter" title="Element Filter">
              <option value="all">All Elements</option>
              <option value="energy">Energy</option>
              <option value="fire">Fire</option>
              <option value="ice">Ice</option>
              <option value="mana">Mana</option>
              <option value="nature">Nature</option>
              <option value="physical">Physical</option>
              <option value="none">No Element</option>
            </select>
          </div>
        </div>
        <div id="seller-filter-chip" class="filter-chip hidden" aria-live="polite">
          <span id="seller-filter-text"></span>
          <button id="clear-seller-filter" type="button" class="chip-clear" title="Clear seller filter" aria-label="Clear seller filter">×</button>
        </div>
        <button id="search-reset" type="button" class="btn btn-primary full-width">Reset Filters</button>
      </div>
    </div>
    <button id="btn-sell-listings" type="button" class="btn btn-primary" style="width:100%;margin-top:.5rem;margin-bottom:1rem">Sell an Item</button>
    </div>

  <div id="listings"></div>
  
  <!-- Listings Loading Indicator -->
  <div id="listings-loader" class="listings-loader hidden">
    <div class="loader-spinner"></div>
    <p>Loading listings...</p>
  </div>
</section>

  </main>

  <!-- Giveaways Section -->
  <section id="giveaways-section" class="card hidden" style="background: linear-gradient(135deg, rgba(0, 33, 51, 0.8), rgba(0, 24, 38, 0.9)); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); margin: 1.5rem 0;">
    <div class="card-header" style="padding: 1.25rem; border-bottom: 1px solid rgba(0, 217, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
      <h2 style="margin: 0; color: #00d9ff; font-size: 1.5rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
        <i class="icon-gift"></i> Active Giveaways
      </h2>
      <button id="create-giveaway-btn" class="btn btn-primary" style="display: none; background: linear-gradient(135deg, #00a8ff, #0097e6); border: none; padding: 0.5rem 1.25rem; border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;">
        <i class="icon-plus" style="margin-right: 6px;"></i> Create Giveaway
      </button>
    </div>
    <div id="giveaways-list" class="listings-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; padding: 1.25rem;">
      <div class="no-giveaways" style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
        <i class="icon-gift" style="font-size: 2rem; margin-bottom: 1rem; display: block; color: rgba(0, 217, 255, 0.5);"></i>
        <p>No active giveaways at the moment. Check back later!</p>
      </div>
    </div>
  </section>

  <!-- Create Giveaway Modal -->
  <div id="create-giveaway-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width: 600px; background: linear-gradient(135deg, rgba(0, 33, 51, 0.95), rgba(0, 24, 38, 0.98)); border: 1px solid rgba(0, 217, 255, 0.2); border-radius: 8px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
      <div class="modal-header" style="padding: 1.25rem; border-bottom: 1px solid rgba(0, 217, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin: 0; color: #00d9ff; font-size: 1.5rem; font-weight: 600; display: flex; align-items: center; gap: 10px;">
          <i class="icon-gift"></i> Create New Giveaway
        </h2>
        <button class="close-modal" style="background: none; border: none; color: rgba(255, 255, 255, 0.6); font-size: 1.5rem; cursor: pointer; transition: color 0.2s; line-height: 1;">&times;</button>
      </div>
      <form id="create-giveaway-form" style="padding: 1.5rem;">
        <div class="form-group" style="margin-bottom: 1.25rem;">
          <label for="giveaway-title" style="display: block; margin-bottom: 0.5rem; color: #00d9ff; font-weight: 500;">Title</label>
          <input type="text" id="giveaway-title" required style="width: 100%; padding: 0.75rem; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 217, 255, 0.3); border-radius: 4px; color: white; font-size: 1rem; transition: all 0.2s;">
        </div>
        
        <div class="form-group" style="margin-bottom: 1.25rem;">
          <label for="giveaway-description" style="display: block; margin-bottom: 0.5rem; color: #00d9ff; font-weight: 500;">Description</label>
          <textarea id="giveaway-description" rows="3" required style="width: 100%; padding: 0.75rem; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 217, 255, 0.3); border-radius: 4px; color: white; font-size: 1rem; resize: vertical; min-height: 100px;"></textarea>
        </div>
        
        <div class="form-group" style="margin-bottom: 1.25rem;">
          <label style="display: block; margin-bottom: 0.5rem; color: #00d9ff; font-weight: 500;">Item to Give Away</label>
          <div id="giveaway-item-selector" style="display: flex; align-items: center; gap: 1rem;">
            <button type="button" id="select-giveaway-item" class="btn btn-outline" style="background: transparent; border: 1px solid #00d9ff; color: #00d9ff; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; transition: all 0.2s; white-space: nowrap;">
              <i class="icon-search" style="margin-right: 6px;"></i> Select Item
            </button>
            <div id="selected-giveaway-item" style="flex: 1; min-height: 50px; background: rgba(0, 0, 0, 0.2); border: 1px dashed rgba(0, 217, 255, 0.3); border-radius: 4px; display: flex; align-items: center; justify-content: center; padding: 0.5rem; color: rgba(255, 255, 255, 0.5); font-size: 0.9rem;">
              No item selected
            </div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
          <div class="form-group">
            <label for="giveaway-duration" style="display: block; margin-bottom: 0.5rem; color: #00d9ff; font-weight: 500;">Duration (hours)</label>
            <input type="number" id="giveaway-duration" min="1" max="168" value="24" style="width: 100%; padding: 0.75rem; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 217, 255, 0.3); border-radius: 4px; color: white;">
          </div>
          <div class="form-group">
            <label for="giveaway-max-entries" style="display: block; margin-bottom: 0.5rem; color: #00d9ff; font-weight: 500;">Max Entries (0 = unlimited)</label>
            <input type="number" id="giveaway-max-entries" min="0" value="0" style="width: 100%; padding: 0.75rem; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 217, 255, 0.3); border-radius: 4px; color: white;">
          </div>
        </div>
        
        <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(0, 217, 255, 0.1);">
          <button type="button" id="cancel-giveaway" class="btn btn-secondary" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 0.5rem 1.25rem; border-radius: 4px; cursor: pointer; transition: all 0.2s;">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #00a8ff, #0097e6); border: none; padding: 0.5rem 1.5rem; border-radius: 4px; color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;">
            <i class="icon-gift" style="margin-right: 6px;"></i> Create Giveaway
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- How To Modal -->
  <div id="how-to-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width: 600px;">
      <h2>How to Create a Listing</h2>
      <div class="how-to-content" style="max-height: 70vh; overflow-y: auto; padding-right: 1rem;">
        <ol>
          <li>Click "Browse Item Types" to select a default item (these will have the possible MAX stats automatically entered)</li>
          <li>Enter a Listing Description. Use #(StatAmount)+TypeOfStat -> Examples: #24melee #24distance #24magic</li>
          <li>Select a Price, whether an Item is Elite, and an Enchant in the Element drop down box.</li>
          <li>You can upload a Screenshot of the item (optional but recommended for faster sales)</li>
          <li>Click "Create Listing" when you're done</li>
        </ol>
        <div style="display: flex; flex-direction: column; gap: 1.5rem; margin-top: 1.5rem;">
          <div>
            <h3>Create Listing</h3>
            <img src="info1.jpg" alt="Create Listing Example" style="max-width: 100%; border-radius: 8px; border: 1px solid var(--border-color);">
          </div>
          <div>
            <h3>View Active Listings</h3>
            <p style="margin-top: 0.5rem; color: #a0a0a0;">You can double tap their screenshots to view them better</p>
            <img src="info2.webp" alt="View Listings Example" style="max-width: 100%; border-radius: 8px; border: 1px solid var(--border-color);">
          </div>
          <div>
            <h3>Seller Profile</h3>
            <p style="margin-top: 0.5rem; color: #a0a0a0;">Click on the Seller's Name to open their profile. From here you can see all the Items for sale from the Seller and their Sold Items History. Double click their Discord Name to copy it.</p>
            <img src="info3.webp" alt="Seller Profile Example" style="max-width: 100%; border-radius: 8px; border: 1px solid var(--border-color);">
          </div>
        </div>
      </div>
      <div class="modal-actions" style="margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 0.5rem;">
        <button id="close-how-to" class="btn btn-primary">Got it!</button>
      </div>
    </div>
  </div>

  <!-- Basic Rules Modal -->
  <div id="rules-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width: 600px;">
      <h2>Basic Rules</h2>
      <div class="rules-content" style="max-height: 70vh; overflow-y: auto; padding-right: 1rem; color: #e0e0e0; line-height: 1.6;">
        <p>MR Auctioner follows the same rules as <a href="https://miragerealms.co.uk/support/knowledgebase.php?article=5" target="_blank" style="color: #00d9ff; text-decoration: none;">Mirage Realms</a>.</p>
        <p>These are some basic rules:</p>
        <ul style="padding-left: 20px; margin: 1rem 0;">
          <li>No Account trading allowed.</li>
          <li>No Trades / Services involving real life currency.</li>
          <li>Don't Register with your Mirage Realms Account, you just need a Username and Password, put your in-game name as the Display Name.</li>
          <li>Post ONE item per Listings. Unless you're selling a FULL Set.</li>
          <li>No Bad Words.</li>
          <li>Don't post weird shit. (pls)</li>
          <li>Use clear item titles and descriptions, include the items name in the title and its stats in the description so others can find it via search.</li>
          <li>Don't use big arse Screenshots/Images.</li>
          <li>Put your Discord Accounts name in the Account menu so users can message you on discord.</li>
          <li>No Scamming.</li>
        </ul>
        <p>Rules might change soon. Your Seller Account will be banned if you break the rules.</p>
      </div>
      <div class="modal-actions" style="margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 0.5rem;">
        <button id="close-rules" class="btn btn-primary">I Understand</button>
      </div>
    </div>
  </div>

  <!-- Image Modal -->
  <div id="image-modal" class="modal hidden">
    <div class="image-modal-content">
      <button id="close-image-modal" type="button" class="image-modal-close" aria-label="Close">&times;</button>
      <img id="modal-image" src="" alt="Full size image" />
    </div>
  </div>

  <footer>
    <small>Mirage Realms Unofficial Experimental Auction House</small>
  </footer>

  <script src="config.js" defer></script>
  <script src="api-service.js" defer></script>
  <script src="items.js" defer></script>
  <script src="app.js" defer></script>

  <!-- Item Type Selector Modal -->
  <div id="item-type-modal" class="modal hidden">
    <div class="modal-inner">
      <h2>Select an Item Type</h2>
      <div id="item-type-categories" class="modal-cats"></div>
      <div id="item-type-gallery" class="modal-gallery"></div>
      <button id="close-item-modal" type="button" class="btn btn-accent">Close</button>
    </div>
  </div>

  <!-- Profile Modal (edit) -->
  <div id="profile-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width: 600px;">
      <h2 class="profile-modal-title">Your Profile</h2>
      <hr />
      <p><strong>Username:</strong> <span id="profile-username"></span></p>
      <label>Display Name <input id="profile-displayname" maxlength="20" /></label>
      <label>Discord Name <input id="profile-discord" maxlength="20" placeholder="e.g. user#1234" /></label>
      <label>Bio <textarea id="profile-bio" rows="4" maxlength="100"></textarea></label>
      <div class="profile-avatar-section">
        <label style="margin-bottom: 0.25rem; display: block; font-weight: 600;">Avatar</label>
        <div class="avatar-upload-row">
          <div id="profile-avatar-wrap" class="avatar-wrap">
            <img id="profile-avatar-preview" src="" alt="avatar" class="avatar-img hidden" />
          </div>
          <label class="btn btn-primary btn-change-avatar">Change Avatar <input id="profile-avatar" type="file" accept=".jpg,.jpeg,.png,.gif,.webp" class="hidden" /></label>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" id="btn-open-change-password" class="btn btn-accent">Change Password</button>
        <button type="button" id="profile-save" class="btn btn-primary">Save</button>
        <button type="button" id="profile-cancel" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id="change-password-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark small">
      <h2 class="profile-modal-title">Change Password</h2>
      <label>Current Password <input id="profile-current-pass" type="password" /></label>
      <label>New Password <input id="profile-new-pass" type="password" /></label>
      <label>Confirm New <input id="profile-new-pass-confirm" type="password" /></label>
      <div class="form-actions">
        <button type="button" id="btn-save-password" class="btn btn-primary">Save Password</button>
        <button type="button" id="btn-cancel-password" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- User Popup (view only) -->
  <div id="user-popup" class="modal hidden">
    <div class="modal-inner modal-inner-dark small">
      <div class="popup-row">
        <div id="popup-avatar-wrap" class="avatar-wrap small">
          <img id="popup-avatar" src="" alt="avatar" class="avatar-img hidden" />
        </div>
        <div style="flex:1">
          <h4 id="popup-displayname" style="margin:0 0 .25rem 0"></h4>
          <div id="popup-discord" class="muted" style="font-size:.9rem;margin-bottom:.25rem"></div>
          <div id="popup-last-seen" class="muted" style="font-size:.85rem;color:var(--primary);display:none;"></div>
        </div>
      </div>
      <div style="margin-top:.75rem;margin-bottom:1.5rem">
        <h5 style="color:var(--primary);margin:.5rem 0 .25rem;font-size:.9rem">Bio</h5>
        <p id="popup-bio" class="muted" style="margin:.25rem 0"></p>
      </div>
      <div class="form-actions">
        <button id="popup-selling" class="btn btn-primary">Selling</button>
        <button id="popup-items-sold" class="btn btn-primary">Items Sold History</button>
        <button id="popup-close" class="btn btn-accent">Close</button>
      </div>
    </div>
  </div>
  <!-- Confirm dialog -->
  <div id="confirm-modal" class="modal hidden">
    <div class="modal-inner small">
      <p id="confirm-message"></p>
      <div class="form-actions">
        <button id="confirm-yes" class="btn btn-accent">Yes</button>
        <button id="confirm-no" class="btn">No</button>
      </div>
    </div>
  </div>

  <!-- Admin / Moderation Panel -->
  <div id="admin-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width: 960px;">
      <h2 id="admin-modal-title">Admin Panel</h2>
      <p class="hint">Manage users below. Actions depend on your role.</p>
      <div id="admin-controls" class="admin-controls">
        <label for="admin-role-filter">Show</label>
        <select id="admin-role-filter" class="search-select">
          <option value="all">All Users</option>
          <option value="normal">Normal Users</option>
          <option value="staff">Admins & Mods</option>
        </select>
        <input id="admin-search" type="text" placeholder="Search users..." style="max-width:260px" />
      </div>
      <div id="admin-users" class="admin-users"></div>
      <div id="admin-pagination" class="admin-pagination">
        <button id="admin-prev" class="btn btn-small">Prev</button>
        <span id="admin-page-label" class="hint"></span>
        <button id="admin-next" class="btn btn-small">Next</button>
      </div>
      <div class="form-actions">
        <button id="admin-close" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Ban modal -->
  <div id="ban-modal" class="modal hidden">
    <div class="modal-inner small">
      <h3 id="ban-title">Ban User</h3>
      <label>Duration (minutes)
        <input id="ban-minutes" type="number" min="1" value="60" />
      </label>
      <label>Reason (optional)
        <input id="ban-reason" type="text" maxlength="80" placeholder="Reason for ban" />
      </label>
      <div class="form-actions">
        <button id="ban-confirm" class="btn btn-accent">Confirm</button>
        <button id="ban-cancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Rename modal -->
  <div id="rename-modal" class="modal hidden">
    <div class="modal-inner small">
      <h3 id="rename-title">Rename Display Name</h3>
      <label>New Display Name
        <input id="rename-input" type="text" maxlength="20" placeholder="Enter new display name" />
      </label>
      <div class="form-actions">
        <button id="rename-confirm" class="btn btn-primary">Confirm</button>
        <button id="rename-cancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Delete Reason modal (for mods) -->
  <div id="delete-reason-modal" class="modal hidden">
    <div class="modal-inner small">
      <h3 id="delete-reason-title">Delete Listing</h3>
      <p class="hint" id="delete-reason-hint">Provide a reason for deleting this item:</p>
      <label>Reason
        <input id="delete-reason-input" type="text" maxlength="100" placeholder="Why is this item being deleted?" />
      </label>
      <div class="form-actions">
        <button id="delete-reason-confirm" class="btn btn-delete">Delete</button>
        <button id="delete-reason-cancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Warning modal (for admins/mods) -->
  <div id="warning-modal" class="modal hidden">
    <div class="modal-inner small">
      <h3 id="warning-title">Add Warning to Item</h3>
      <p class="hint" id="warning-hint">Warn the seller about this item:</p>
      <label>Warning Reason
        <textarea id="warning-reason-input" rows="3" maxlength="200" placeholder="Describe the issue with this listing..."></textarea>
      </label>
      <div class="form-actions">
        <button id="warning-confirm" class="btn btn-accent">Send Warning</button>
        <button id="warning-cancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Warnings/Notifications modal -->
  <div id="warnings-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width: 800px;">
      <h2>Warnings & Notifications</h2>
      <p class="hint">View warnings and notifications about your listings.</p>
      <div id="warnings-list" class="warnings-list"></div>
      <div class="form-actions">
        <button id="warnings-close" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Items Sold History modal -->
  <div id="items-sold-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width: 800px;">
      <h2 id="items-sold-title">Items Sold History</h2>
      <p class="hint">All items you've sold, including deleted listings.</p>
      <div id="items-sold-list" class="items-sold-list"></div>
      <div id="items-sold-pagination" class="admin-pagination">
        <button id="items-sold-prev" class="btn btn-small">Prev</button>
        <span id="items-sold-page-label" class="hint"></span>
        <button id="items-sold-next" class="btn btn-small">Next</button>
      </div>
      <div class="form-actions">
        <button id="items-sold-close" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Listing Detail modal -->
  <div id="listing-detail-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width:720px;">
      <h2 id="listing-detail-title" style="display:flex;align-items:center;gap:.5rem;margin-top:0"></h2>
      <div id="listing-detail-meta" class="hint" style="margin:.25rem 0 .75rem"></div>
      <div id="listing-detail-info" class="hint" style="margin:.25rem 0"></div>
      <div id="listing-detail-notes" style="margin:.5rem 0"></div>
      <div class="section-separator"></div>
      <div id="listing-detail-image" class="image-container no-image"><span>Loading...</span></div>
      <div class="detail-bottom-separator"></div>
      <div class="form-actions" style="margin-top:1rem;justify-content:flex-end">
        <button id="listing-detail-close" class="btn btn-accent">Close</button>
      </div>
    </div>
  </div>

  <!-- Moderation History modal -->
  <div id="mod-history-modal" class="modal hidden">
    <div class="modal-inner modal-inner-dark" style="max-width: 960px;">
      <h2>Moderation History</h2>
      <p class="hint">All moderation actions taken by staff.</p>
      <div id="mod-history-list" class="mod-history-list"></div>
      <div class="form-actions">
        <button id="mod-history-close" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- Help / FAQ Modal -->
  <div id="help-modal" class="modal hidden" aria-labelledby="help-modal-title" aria-modal="true" role="dialog">
    <div class="modal-inner modal-inner-dark" style="max-width:800px;">
      <h2 id="help-modal-title" style="margin-top:0">FAQ & User Guide</h2>
      <p class="hint" style="margin-top:.25rem">Learn how to use all MR Auctioner features.</p>
<div class="help-content" style="max-height:70vh;overflow-y:auto;padding-right:.5rem;display:flex;align-items:center;justify-content:center;">
  <div class="nub-banner" role="note" aria-label="Humorous help message">
    <span class="nub-text">Figure it out urself nub</span>
  </div>
</div>
      <div class="form-actions" style="margin-top:1.25rem;justify-content:center">
        <button id="help-close" class="btn btn-accent">Close</button>
      </div>
    </div>
    </div>
  </div>

</body>
</html>